<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Kai Wu | Camera visualization in Matlab</title>
  <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design.
">

  <link rel="shortcut icon" href="//imkaywu.github.io/assets/img/favicon.ico">

  <link rel="stylesheet" href="//imkaywu.github.io/assets/css/main.css">
  <link rel="canonical" href="//imkaywu.github.io/blog/2017/05/draw-camera/">
</head>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>

  <body>

    <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
        
        <strong>Kai</strong> Wu
    </span>
    

    <nav class="site-nav">

      <div class="trigger">
        <!-- About -->
        <a class="page-link" href="//imkaywu.github.io/">about</a>

        <!-- Blog -->
        <a class="page-link" href="//imkaywu.github.io/blog/">blog</a>

        <!-- Pages -->
        
          
        
          
            <a class="page-link" href="//imkaywu.github.io/code/">code</a>
          
        
          
        
          
            <a class="page-link" href="//imkaywu.github.io/links/">links</a>
          
        
          
        
          
            <a class="page-link" href="//imkaywu.github.io/projects/">projects</a>
          
        
          
        
          
        
          
        

        <!-- CV link -->
        <!-- <a class="page-link" href="//imkaywu.github.io/assets/pdf/CV.pdf">vitae</a> -->

      </div>
    </nav>

  </div>

</header>



    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Camera visualization in Matlab</h1>
    <p class="post-meta">May 31, 2017</p>
  </header>

  <article class="post-content">
    <p>I read somewhere that to be more efficient in a long run when it comes to implementing a library, the first thing you should implement is the code that does visualization. To 3D computer vision, the single most important or common place component is probably the camera. This is what we are going to do here.</p>

<h3 id="visualization">Visualization</h3>
<div class="img_row">
    <img class="col one" src="/assets/img/open3DCV/viz/viz_cam_1.png" alt="" title="example image" />
    <img class="col one" src="/assets/img/open3DCV/viz/viz_cam_2.png" alt="" title="example image" />
    <img class="col one" src="/assets/img/open3DCV/viz/viz_cam_3.png" alt="" title="example image" />
</div>

<div class="language-matlab highlighter-rouge"><pre class="highlight"><code><span class="c1">% example code to visualize N synthetic cameras</span>
<span class="nb">close</span> <span class="nb">all</span><span class="p">;</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="n">ang</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">pi</span> <span class="p">/</span> <span class="n">N</span><span class="p">;</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">;</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>

<span class="k">for</span> <span class="nb">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">N</span>
    <span class="n">cos_ang</span> <span class="o">=</span> <span class="nb">cos</span><span class="p">(</span><span class="nb">i</span> <span class="o">*</span> <span class="n">ang</span><span class="p">);</span>
    <span class="n">sin_ang</span> <span class="o">=</span> <span class="nb">sin</span><span class="p">(</span><span class="nb">i</span> <span class="o">*</span> <span class="n">ang</span><span class="p">);</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">sin_ang</span><span class="p">,</span>  <span class="n">cos_ang</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
          <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>      <span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="k">...</span><span class="c"> </span>
         <span class="o">-</span><span class="n">cos_ang</span><span class="p">,</span> <span class="o">-</span><span class="n">sin_ang</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="p">[</span><span class="n">cos_ang</span><span class="p">,</span> <span class="n">sin_ang</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">'</span><span class="p">;</span>
    
    <span class="c1">% implementation 1</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">,</span> <span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">c</span><span class="p">];</span>
    <span class="n">drawCamera</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="c1">% implementation 2</span>
<span class="c1">%     K = [f 0 w/2; 0 f h/2; 0 0 1];</span>
<span class="c1">%     t = -R*c;</span>
<span class="c1">%     draw_camera(K, R, t);</span>
    
    <span class="c1">% implementation 3</span>
<span class="c1">%     K = [f 0 w/2; 0 f h/2; 0 0 1];</span>
<span class="c1">%     camera(i).w = w;</span>
<span class="c1">%     camera(i).h = h;</span>
<span class="c1">%     camera(i).K = K;</span>
<span class="c1">%     camera(i).R = R;</span>
<span class="c1">%     camera(i).c = c; % camera center in world coordinate system</span>
<span class="k">end</span>

<span class="c1">% showcamera(camera);</span>

<span class="nb">xlabel</span><span class="p">(</span><span class="s1">'x'</span><span class="p">);</span> <span class="nb">ylabel</span><span class="p">(</span><span class="s1">'y'</span><span class="p">);</span> <span class="nb">zlabel</span><span class="p">(</span><span class="s1">'z'</span><span class="p">);</span>
<span class="nb">axis</span> <span class="n">equal</span><span class="p">;</span>
<span class="nb">view</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="nb">title</span><span class="p">(</span><span class="s1">'implementation 2'</span><span class="p">);</span>
</code></pre>
</div>

<h3 id="first-implementation">First implementation</h3>
<p>The first implementation comes from the SFMedu2 by Dr. Jianxiong Xiao. Assume that the focal length is <script type="math/tex">f</script>, the coordinates of the center of projection and the four corners of the images plane in the camera coordinate system is: <script type="math/tex">(0, 0, 0)</script>, <script type="math/tex">(-\frac{w}{2}, -\frac{h}{2}, f)</script>, <script type="math/tex">(\frac{w}{2}, -\frac{h}{2}, f)</script>, <script type="math/tex">(\frac{w}{2}, \frac{h}{2}, f)</script>, <script type="math/tex">(-\frac{w}{2}, \frac{h}{2}, f)</script>. Points on the axes of the camera coordinate system are: <script type="math/tex">(f, 0, 0)</script>, <script type="math/tex">(0, f, 0)</script>, <script type="math/tex">(0, 0, f)</script>.</p>

<p>The next step is to transform these point from camera coordinate system to world coordinate system</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\begin{bmatrix} X_c \\1 \end{bmatrix} &= \begin{bmatrix} R_{wc} & T_{wc} \\ \vec{0}^T & 1 \end{bmatrix} \begin{bmatrix} X_w \\1 \end{bmatrix}\\
\left[\begin{matrix} X_w \\1 \end{matrix}\right] &= \left[\begin{matrix} R_{wc} & T_{wc} \\ \vec{0}^T & 1 \end{matrix}\right]' * \left[\begin{matrix} X_c \\1 \end{matrix}\right]\\
&= \left[\begin{matrix} R_{wc}' & -R_{wc}'T_{wc} \\ \vec{0}^T & 1 \end{matrix}\right] * \left[\begin{matrix} X_c \\1 \end{matrix}\right]\\
\leftrightarrow X_w &= R_{wc}'*(X_c-T_{wc})
\end{align} %]]></script>

<div class="language-matlab highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">drawCamera</span><span class="p">(</span><span class="n">Rt</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">lineWidth</span><span class="p">)</span>
<span class="c1">% SFMedu: Structrue From Motion for Education Purpose</span>
<span class="c1">% Written by Jianxiong Xiao (MIT License)</span>

<span class="c1">% Xcamera = Rt * Xworld</span>
  <span class="n">V</span><span class="o">=</span><span class="p">[</span><span class="k">...</span>
  <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="n">f</span> <span class="o">-</span><span class="n">w</span><span class="p">/</span><span class="mi">2</span>  <span class="n">w</span><span class="p">/</span><span class="mi">2</span> <span class="n">w</span><span class="p">/</span><span class="mi">2</span> <span class="o">-</span><span class="n">w</span><span class="p">/</span><span class="mi">2</span>
  <span class="mi">0</span> <span class="mi">0</span> <span class="n">f</span> <span class="mi">0</span> <span class="o">-</span><span class="n">h</span><span class="p">/</span><span class="mi">2</span> <span class="o">-</span><span class="n">h</span><span class="p">/</span><span class="mi">2</span> <span class="n">h</span><span class="p">/</span><span class="mi">2</span>  <span class="n">h</span><span class="p">/</span><span class="mi">2</span>
  <span class="mi">0</span> <span class="n">f</span> <span class="mi">0</span> <span class="mi">0</span>  <span class="n">f</span>    <span class="n">f</span>    <span class="n">f</span>   <span class="n">f</span><span class="p">];</span>

  <span class="n">V</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
  <span class="n">V</span> <span class="o">=</span> <span class="n">R</span><span class="o">'*</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="nb">repmat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">size</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="mi">2</span><span class="p">)));</span>

  <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">4</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">4</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">4</span><span class="p">]),</span><span class="s1">'-r'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% plot x-axis</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">3</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">3</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">3</span><span class="p">]),</span><span class="s1">'-g'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% plot y-axis</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span><span class="s1">'-b'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% plot z-axis</span>

  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">5</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">5</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">5</span><span class="p">]),</span><span class="s1">'-k'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% center to up-left corner</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">6</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">6</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">6</span><span class="p">]),</span><span class="s1">'-k'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% center to up-right corner</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">7</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">7</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">7</span><span class="p">]),</span><span class="s1">'-k'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% center to lower-right corner</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">8</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">8</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">8</span><span class="p">]),</span><span class="s1">'-k'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% center to lower-left corner</span>

  <span class="nb">plot3</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">5</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">5</span><span class="p">]),</span><span class="n">V</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">5</span><span class="p">]),</span><span class="s1">'-k'</span><span class="p">,</span><span class="s1">'LineWidth'</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">);</span> <span class="c1">% image plane</span>
  <span class="nb">hold</span> <span class="n">off</span><span class="p">;</span>
<span class="k">end</span>

</code></pre>
</div>

<h3 id="second-implementation">Second implementation</h3>
<p>This implementation comes from the camera calibration toolbox implemented by Dr. Jean-Yves Bouguet. The key idea is the same, but instead of representing corners of image plane in the camera coordinate system, the corners are in the image plane, where the origin is at the up-left corner.</p>

<p>The image corners are defined in the image plane coordinate system, thus the center of the upper left corner pixel is <script type="math/tex">[0;0]</script>, the center of the upper right corner pixel is <script type="math/tex">[nx-1;0]</script>, the center of the lower left corner pixel is <script type="math/tex">[0;ny-1]</script>, and the center of the lower right corner pixel is <script type="math/tex">[nx-1;ny-1]</script>. <script type="math/tex">nx</script> and <script type="math/tex">ny</script> are the width and height of the image in pixel.</p>

<p>The first step is to transform these point from image plane coordinate system back to the camera coordinate system by left multiplying <script type="math/tex">K'</script>.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
K &= \begin{bmatrix} 
      1 & 0 & cc(1)\\
      0 & 1 & cc(2)\\
      0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix} 
      fc(1) & 0 & 0\\
      0 & fc(2) & 0\\
      0 & 0 & 1
    \end{bmatrix}
    \begin{bmatrix} 
      1 & alpha_c & 0\\
      0 & 1 & 0\\
      0 & 0 & 1
    \end{bmatrix}\\
K' &= \begin{bmatrix} 
        1 & -alpha_c & 0\\
        0 & 1 & 0\\
        0 & 0 & 1
      \end{bmatrix}
      \begin{bmatrix} 
        1/fc(1) & 0 & 0\\
        0 & 1/fc(2) & 0\\
        0 & 0 & 1
      \end{bmatrix}
      \begin{bmatrix} 
        1 & 0 & -cc(1)\\
        0 & 1 & -cc(2)\\
        0 & 0 & 1
      \end{bmatrix}
\end{align} %]]></script>

<p>The second step is the same as the one implemented above, transform points from the camera coordinate system to world coordinate system.</p>

<div class="language-matlab highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">draw_camera</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
  <span class="n">alpha_c</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">fc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">fc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">cc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">cc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">K</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  
  <span class="c1">% for test purpose</span>
  <span class="n">nx</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span> <span class="n">dX</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="n">dY</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

  <span class="c1">% step 1: image plane to camera coordinate system</span>
  <span class="n">IP</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">dX</span><span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span><span class="n">alpha_c</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">0</span>  <span class="mi">1</span>       <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">0</span>  <span class="mi">0</span>       <span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="k">...</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">/</span><span class="n">fc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="mi">0</span>       <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">0</span>       <span class="mi">1</span><span class="p">/</span><span class="n">fc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">0</span>       <span class="mi">0</span>       <span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="k">...</span>
            <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span> <span class="o">-</span><span class="n">cc</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="k">...</span>
             <span class="mi">0</span> <span class="mi">1</span> <span class="o">-</span><span class="n">cc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="k">...</span>
             <span class="mi">0</span> <span class="mi">0</span>  <span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="k">...</span>
            <span class="p">[</span><span class="mi">0</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span> <span class="n">nx</span><span class="o">-</span><span class="mi">1</span> <span class="mi">0</span>    <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">0</span> <span class="mi">0</span>    <span class="n">ny</span><span class="o">-</span><span class="mi">1</span> <span class="n">ny</span><span class="o">-</span><span class="mi">1</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
             <span class="mi">1</span> <span class="mi">1</span>    <span class="mi">1</span>    <span class="mi">1</span>    <span class="mi">1</span><span class="p">];</span>
  <span class="n">BASE</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">dX</span><span class="o">*</span><span class="p">([</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
                <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">;</span><span class="k">...</span>
                <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]);</span>

  <span class="n">IP</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">([</span><span class="n">IP</span><span class="p">;</span><span class="n">BASE</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span><span class="n">IP</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span>

  <span class="c1">% step 2: camera coordinate system to world coordinate system</span>
  <span class="n">BASE</span> <span class="o">=</span> <span class="n">R</span><span class="o">'</span> <span class="o">*</span> <span class="p">(</span><span class="n">BASE</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
  <span class="n">IP</span> <span class="o">=</span> <span class="n">R</span><span class="o">'</span> <span class="o">*</span> <span class="p">(</span><span class="n">IP</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">));</span>

  <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">BASE</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span><span class="n">BASE</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">BASE</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]),</span><span class="s1">'r-'</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="o">'</span><span class="p">);</span> <span class="c1">% x-axis</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">BASE</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">3</span> <span class="mi">4</span><span class="p">]),</span><span class="n">BASE</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">3</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">BASE</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">3</span> <span class="mi">4</span><span class="p">]),</span><span class="s1">'g-'</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="o">'</span><span class="p">);</span> <span class="c1">% y-axis</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">BASE</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span><span class="p">]),</span><span class="n">BASE</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span><span class="p">]),</span> <span class="n">BASE</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">5</span> <span class="mi">6</span><span class="p">]),</span><span class="s1">'b-'</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="o">'</span><span class="p">);</span> <span class="c1">% z-axis</span>
  <span class="nb">plot3</span><span class="p">(</span><span class="n">IP</span><span class="p">(</span><span class="mi">1</span><span class="p">,:),</span><span class="n">IP</span><span class="p">(</span><span class="mi">2</span><span class="p">,:),</span> <span class="n">IP</span><span class="p">(</span><span class="mi">3</span><span class="p">,:),</span> <span class="s1">'k-'</span><span class="p">,</span><span class="s1">'linewidth'</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="k">end</span>
</code></pre>
</div>

<h3 id="third-implementation">Third implementation</h3>
<p>The third implementation comes from the <a href="https://blogs.mathworks.com/loren/2009/12/16/carving-a-dinosaur/">Carving a Dinosaur</a>. The biggest difference is that this implementation draws the corresponding image on the image plane.</p>
<div class="language-matlab highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">showcamera</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">camera</span><span class="p">)</span>
<span class="c1">%SHOWCAMERA: draw a schematic of a camera</span>
<span class="c1">%</span>
<span class="c1">%   SHOWCAMERA(CAMERA) draws a camera on the current axes</span>
<span class="c1">%</span>
<span class="c1">%   SHOWCAMERA(AXES,CAMERA) draws a camera on the specified axes</span>
<span class="c1">%</span>
<span class="c1">%   Example:</span>
<span class="c1">%   &gt;&gt; cameras = loadcameradata(1:3);</span>
<span class="c1">%   &gt;&gt; showcamera(cameras)</span>
<span class="c1">%</span>
<span class="c1">%   See also: LOADCAMERADATA</span>

<span class="c1">%   Copyright 2005-2009 The MathWorks, Inc.</span>
<span class="c1">%   $Revision: 1.0 $    $Date: 2006/06/30 00:00:00 $</span>

<span class="k">if</span> <span class="nb">nargin</span><span class="o">&lt;</span><span class="mi">2</span>
    <span class="n">camera</span> <span class="o">=</span> <span class="n">ax</span><span class="p">;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">gca</span><span class="p">();</span>
<span class="k">end</span>

<span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">subsample</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="k">for</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="nb">numel</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
    <span class="n">cam_c</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">c</span><span class="p">;</span>
    
    <span class="nb">hold</span> <span class="n">on</span><span class="p">;</span>
    <span class="c1">% Draw the camera centre</span>
    <span class="nb">plot3</span><span class="p">(</span><span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">'b.'</span><span class="p">,</span><span class="s1">'markersize'</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
    
    <span class="c1">% Now work out where the image corners are</span>
<span class="c1">%     [h,w,colordepth] = size(camera(c).Image); %#ok&lt;NASGU&gt;</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">w</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">h</span><span class="p">;</span> <span class="c1">% for test</span>
    
    <span class="n">imcorners</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="n">w</span> <span class="mi">0</span> <span class="n">w</span>
        <span class="mi">0</span> <span class="mi">0</span> <span class="n">h</span> <span class="n">h</span>
        <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">];</span>
    <span class="n">worldcorners</span> <span class="o">=</span> <span class="n">iBackProject</span><span class="p">(</span> <span class="n">imcorners</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">);</span>
    
    <span class="n">iPlotLine</span><span class="p">(</span><span class="n">cam_c</span><span class="p">,</span> <span class="n">worldcorners</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'b-'</span><span class="p">)</span>
    <span class="n">iPlotLine</span><span class="p">(</span><span class="n">cam_c</span><span class="p">,</span> <span class="n">worldcorners</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="s1">'b-'</span><span class="p">)</span>
    <span class="n">iPlotLine</span><span class="p">(</span><span class="n">cam_c</span><span class="p">,</span> <span class="n">worldcorners</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="s1">'b-'</span><span class="p">)</span>
    <span class="n">iPlotLine</span><span class="p">(</span><span class="n">cam_c</span><span class="p">,</span> <span class="n">worldcorners</span><span class="p">(:,</span><span class="mi">4</span><span class="p">),</span> <span class="s1">'b-'</span><span class="p">)</span>
    
    <span class="c1">% Now draw the image plane. We will need the coords of every pixel in order</span>
    <span class="c1">% to do the texturemap</span>
    <span class="n">draw_texture</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">~</span><span class="n">draw_texture</span>
        <span class="n">iPlotLine</span><span class="p">(</span><span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'k-'</span><span class="p">);</span>
        <span class="n">iPlotLine</span><span class="p">(</span><span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">'k-'</span><span class="p">);</span>
        <span class="n">iPlotLine</span><span class="p">(</span><span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">'k-'</span><span class="p">);</span>
        <span class="n">iPlotLine</span><span class="p">(</span><span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">worldcorners</span><span class="p">(:,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">'k-'</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">meshgrid</span><span class="p">(</span> <span class="mi">1</span><span class="p">:</span><span class="n">subsample</span><span class="p">:</span><span class="n">w</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">subsample</span><span class="p">:</span><span class="n">h</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">(:),</span><span class="n">y</span><span class="p">(:),</span><span class="n">z</span><span class="p">(:)]</span><span class="o">'</span><span class="p">;</span>
        <span class="n">worldpix</span> <span class="o">=</span> <span class="n">iBackProject</span><span class="p">(</span> <span class="n">pix</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">);</span>
        <span class="n">smallim</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">subsample</span><span class="p">:</span><span class="k">end</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">subsample</span><span class="p">:</span><span class="k">end</span><span class="p">,:);</span>
        <span class="nb">surface</span><span class="p">(</span><span class="s1">'XData'</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">worldpix</span><span class="p">(</span><span class="mi">1</span><span class="p">,:),</span><span class="n">h</span><span class="p">/</span><span class="n">subsample</span><span class="p">,</span><span class="n">w</span><span class="p">/</span><span class="n">subsample</span><span class="p">),</span> <span class="k">...</span>
            <span class="s1">'YData'</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">worldpix</span><span class="p">(</span><span class="mi">2</span><span class="p">,:),</span><span class="n">h</span><span class="p">/</span><span class="n">subsample</span><span class="p">,</span><span class="n">w</span><span class="p">/</span><span class="n">subsample</span><span class="p">),</span> <span class="k">...</span>
            <span class="s1">'ZData'</span><span class="p">,</span> <span class="nb">reshape</span><span class="p">(</span><span class="n">worldpix</span><span class="p">(</span><span class="mi">3</span><span class="p">,:),</span><span class="n">h</span><span class="p">/</span><span class="n">subsample</span><span class="p">,</span><span class="n">w</span><span class="p">/</span><span class="n">subsample</span><span class="p">),</span> <span class="k">...</span>
            <span class="s1">'FaceColor'</span><span class="p">,</span><span class="s1">'texturemap'</span><span class="p">,</span> <span class="k">...</span>
            <span class="s1">'EdgeColor'</span><span class="p">,</span><span class="s1">'none'</span><span class="p">);</span> <span class="c1">% 'CData', smallim </span>
    <span class="k">end</span>
<span class="k">end</span>
<span class="nb">set</span><span class="p">(</span> <span class="n">ax</span><span class="p">,</span><span class="s1">'DataAspectRatio'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

<span class="c1">%-------------------------------------------------------------------------%</span>
<span class="k">function</span> <span class="n">X</span> <span class="o">=</span> <span class="n">iBackProject</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">camera</span> <span class="p">)</span>
<span class="c1">%IBACKPROJECT - backproject an image location a distance DIST and return</span>
<span class="c1">%   the equivalent world location.</span>
<span class="k">if</span> <span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">;</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))];</span>
<span class="k">end</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">K</span> <span class="p">\</span> <span class="n">x</span><span class="p">;</span>
<span class="n">normX</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">X</span><span class="o">.*</span><span class="n">X</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">.</span><span class="p">/</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">normX</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span>
<span class="n">X</span> <span class="o">=</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">size</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">camera</span><span class="o">.</span><span class="n">R</span><span class="o">'*</span><span class="n">X</span><span class="p">;</span>

<span class="c1">%-------------------------------------------------------------------------%</span>
<span class="k">function</span> <span class="n">iPlotLine</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
<span class="nb">plot3</span><span class="p">([</span><span class="n">x0</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">x1</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="p">[</span><span class="n">x0</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">x1</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="p">[</span><span class="n">x0</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">x1</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span> <span class="n">style</span><span class="p">);</span>
</code></pre>
</div>

  </article>

  

</div>

      </div>
    </div>

    <footer>

  <div class="wrapper">
    &copy; Copyright 2017 Kai Wu.
    Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank">GitHub Pages</a>.

    
  </div>

</footer>


    <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="//imkaywu.github.io/assets/js/common.js"></script>





<!-- Include custom icon fonts -->
<link rel="stylesheet" href="//imkaywu.github.io/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="//imkaywu.github.io/assets/css/academicons.min.css">

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-XXXXXXXX-X', 'auto');
ga('send', 'pageview');
</script>


  </body>

</html>
